<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>üçπ Cocktail Pi</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://simonaubury.com/index.xml">
		<link rel="canonical" href="https://simonaubury.com/202005_cocktailpi/post/">
		
		<link rel="shortcut icon" type="image/png" href="https://simonaubury.com/apple-touch-icon-precomposed.png">
		
		
		<meta name="generator" content="Hugo 0.68.3" />

		
		<meta property="og:title" content="üçπ Cocktail Pi" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://simonaubury.com/202005_cocktailpi/00000002.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://simonaubury.com/202005_cocktailpi/post/" />
		<meta property="og:site_name" content="üçπ Cocktail Pi" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://simonaubury.com/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://simonaubury.com/css/story.css" />
		<link rel="stylesheet" href="https://simonaubury.com/css/descartes.css" />
		
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://simonaubury.com/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-202005_cocktailpi page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://simonaubury.com/202005_cocktailpi/00000002.jpeg'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://simonaubury.com/" title="Home">
						<img src="https://simonaubury.com/img/logo.jpg" class="w2 h2 br-100" alt="Simon Aubury Site" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/simonaubury/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/saubury/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/simonaubury/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://simonaubury.com/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://simonaubury.com/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">üçπ Cocktail Pi</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2020-05-18T12:00:00&#43;11:00">May 18, 2020</time>
								<span class="display-print">by </span>
								
								<span class="display-print">at https://simonaubury.com/202005_cocktailpi/post/</span>
							
						
					</h2>
				</div>

				
				
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links mw7">
	<h1 id="-cocktail-pi">üçπ Cocktail Pi</h1>
<p>Cocktails based on your mood created by a Raspberry Pi bartender. Drinks are selected based on your emotion and multilingual voice prompts let you know when your drink is available.</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/8q_5STFzJ6c" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>How to build a fully automated home build cocktail maker. Code available at <a href="https://github.com/saubury/cocktail-pi">**https://github.com/saubury/cocktail-pi</a>**üç∏</p>
<h2 id="pumps">Pumps</h2>
<p>I used 4 <a href="https://en.wikipedia.org/wiki/Peristaltic_pump">peristaltic pumps</a> to provide a ‚Äúfood safe‚Äù way to pump the liquids from the drink bottles. These pumps provide a steady rate of flow of liquids when powered. By carefully timing the ‚Äúon‚Äù time for the pump I can precisely deliver the ideal amount of spirits or mixers for the perfect üç∏</p>
<p><img src="/202005_cocktailpi/00000000.jpeg" alt="A quick search on AliExpress"><em>A quick search on AliExpress</em></p>
<p><img src="/202005_cocktailpi/00000001.jpeg" alt="Pumps ‚Äî straight from the post"><em>Pumps ‚Äî straight from the post</em></p>
<p>The pumps are mounted on a basic wooden frame higher than the tallest bottle. My children helped to build the frame, labelling and installing the pumps.</p>
<p><img src="/202005_cocktailpi/00000002.jpeg" alt="The important task of adding labels to pumps"><em>The important task of adding labels to pumps</em></p>
<p>A view from the rear show the placement of pumps and liquids. A manual electrical switch allow the pumps to be run independently from the Raspberry Pi (helpful for cleaning).</p>
<p><img src="/202005_cocktailpi/00000003.jpeg" alt="Rear view of Cocktail maker"><em>Rear view of Cocktail maker</em></p>
<p>The pumps use 12 volt motors. To operate them via the Raspberry Pi I used a <a href="https://www.jaycar.com.au/arduino-compatible-4-channel-12v-relay-module/p/XC4440">4 Channel 12V Relay Module</a>. This allows the pumps to be switched on and off independently with the 5 volt signals from the <a href="https://www.raspberrypi.org/documentation/usage/gpio/">GPIO pins</a> of the Raspberry Pi.</p>
<p><img src="/202005_cocktailpi/00000004.jpeg" alt="Relay board"><em>Relay board</em></p>
<p>The Raspberry Pi is mounted with the relay board. The relays switch 12 volt power on and off for the pump motors. The signals for the relay board are taken directly from the GPIO header of the Raspberry Pi.</p>
<p><img src="/202005_cocktailpi/00000005.jpeg" alt="Board placement"><em>Board placement</em></p>
<h2 id="software--storing-recipes">Software ‚Äî Storing Recipes</h2>
<p><a href="./recipe.py">Recipes</a> are stored as a map of ingredients with the number of millilitres required for the perfect drink. My idea of a great <em>Vodka Lime Soda</em> is 20ml of Vodka, 70ml of Tonic and 30ml of Lime cordial. The code mapping for this is noted below.</p>
<pre><code>pump_map = {&quot;PUMP_A&quot;: &quot;Vodka&quot;, &quot;PUMP_B&quot;: &quot;Cranberry&quot;, &quot;PUMP_C&quot;: &quot;Tonic&quot;, &quot;PUMP_D&quot;: &quot;Lime&quot;}

recipe_vodkasoda = {&quot;Name&quot;: &quot;Vodka Soda&quot;, &quot;Vodka&quot;: 20, &quot;Tonic&quot;: 70}
recipe_vodkasodacranburry = {&quot;Name&quot;: &quot;Vodka Soda Cranberry&quot;, &quot;Vodka&quot;: 20, &quot;Tonic&quot;: 70, &quot;Cranberry&quot;: 40}
**recipe_vodkalimesoda = {&quot;Name&quot;: &quot;Vodka Lime Soda&quot;, &quot;Vodka&quot;: 20, &quot;Tonic&quot;: 70, &quot;Lime&quot;: 30}**
recipe_limesoda = {&quot;Name&quot;: &quot;Lime Soda&quot;, &quot;Tonic&quot;: 70, &quot;Lime&quot;: 30}
recipe_test = {&quot;Name&quot;: &quot;Test&quot;, &quot;Vodka&quot;: 10, &quot;Cranberry&quot;: 20, &quot;Tonic&quot;: 30, &quot;Lime&quot;:40}
</code></pre>
<h2 id="dispensing-the-perfect-amount">Dispensing the perfect amount</h2>
<p>The pumps I‚Äôm using dispense 1.9mL of liquid per second. I can delegate each pump to a thread timer so it knows how long to operate for once the drink is selected. Have a look at <a href="./pump.py">pump.py</a> for complete code</p>
<pre><code>*# Return the number of seconds to run*
def lookup_time(drink_name, pump_name):
    ML_per_second = 1.9 
    num_ML = drink_name[pump_map[pump_name]]
    return num_ML / ML_per_second

*# Run a pump for given number of seconds*
def pump_thread_runner(gpio_pump_name, run_seconds):
    GPIO.output(gpio_pump_name, GPIO.HIGH)
    time.sleep(run_seconds)
    GPIO.output(gpio_pump_name, GPIO.LOW)

*# Pick a drink*
this_drink = recipe_vodkasoda

*# How long to run each pump ...*
duration_a = lookup_time(this_drink, &quot;PUMP_A&quot;)
duration_b = lookup_time(this_drink, &quot;PUMP_B&quot;)

*# these threads start in background*
pump_thread_start(config.gpio_pump_a, duration_a)
pump_thread_start(config.gpio_pump_b, duration_b)
</code></pre>
<h2 id="emotion-and-age">Emotion and Age</h2>
<p>I use the <a href="https://aws.amazon.com/rekognition/">AWS Rekognition</a> service to determine likely emotion and approximate age. A photo is saved as a jpeg. Uploaded to the AWS Rekognition service I get a JSON string describing the emotion, gender and ago. Have a look at <a href="./cloud.py">cloud.py</a> for complete code</p>
<pre><code>*# Save camera image to file file_jpg*
with picamera.PiCamera() as camera:
    camera.capture(file_jpg)

*# Process file_jpg using AWS rekognition to extract emotion and age*
with open(file_jpg, 'rb') as f_file_jpg:
    b_a_jpg = bytearray(f_file_jpg.read())
    rclient = boto3.client('rekognition')
    response = rclient.detect_faces(Image={'Bytes': b_a_jpg}, Attributes=['ALL'])
</code></pre>
<h2 id="spoken-words">Spoken words</h2>
<p>For <em>text to speech</em> I used the <a href="https://aws.amazon.com/polly/">AWS Polly</a> service. A text string can be converted into with a spoken voice saved as an mp3 audio file. Selecting the appropriate ‚Äúvoice‚Äù is language specific (although it is fun to have the English works spoken with a French accent). Have a look at <a href="./cloud.py">cloud.py</a> for complete code</p>
<pre><code>*# Using &quot;Emma&quot; as am English voice, generate text to voice*
voice='Emma'
client = boto3.client('polly')
response = client.synthesize_speech(OutputFormat='mp3', Text=audiotext, VoiceId=voice)    
thebytes = response['AudioStream'].read()
thefile = open(file_mp3, 'wb')
thefile.write(thebytes)
thefile.close()

*# Play mp3 file via speaker*
os.system('mpg123 -q {}'.format(file_mp3))
</code></pre>
<h2 id="summary">Summary</h2>
<p>A few hours and a bit of programming and you too can enjoy a üçπ cocktail pi. Enjoy!</p>
<p>Project code ‚Äî <a href="https://github.com/saubury/cocktail-pi">**https://github.com/saubury/cocktail-pi</a>**</p>
<p><img src="/202005_cocktailpi/00000006.jpeg" alt="Drinks are ready"><em>Drinks are ready</em></p>

</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					
				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://simonaubury.com/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2021 
			</p>
		</footer>
		
	
	
	</body>
</html>
