<!DOCTYPE html>
<html lang="en-au" dir="ltr">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Can ML predict where my cat is now — part 2 &middot; Simon Aubury</title>
  <meta name="description" content="Where did I leave the cat?" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://simonaubury.com/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://simonaubury.com/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://simonaubury.com/favicon-16x16.png">
  <link href="https://simonaubury.com/css/katex.min.css" rel="stylesheet">
  
  
  
  
  <link href="https://simonaubury.com/css/concated.min.css" rel="stylesheet">
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7N67PMRZ6N"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-7N67PMRZ6N', { 'anonymize_ip': false });
}
</script>

  
</head>

  <body class="single-body">
    <nav class="nav-bar side-padding">
  <h1 class="nav-header"><a href="https://simonaubury.com/" class="nav-text">simon aubury</a></h1>
  <div class="hamburger-menu">
    <input class="hamburger-menu-button" type="checkbox"
      onclick="hamburgerMenuPressed.call(this)"
      aria-label="Hamburger Menu Button"
    >
    <div class="hamburger-menu-icon">
      <span></span>
      <span></span>
    </div>
    <ul id="menu" class="hamburger-menu-overlay">
      <li><a href="https://simonaubury.com/" class="hamburger-menu-overlay-link">Home</a></li>
      <li><a href="https://simonaubury.com/slides/" class="hamburger-menu-overlay-link">Presentation slides</a></li>
      <li><a href="https://simonaubury.com/about-me/" class="hamburger-menu-overlay-link">About Simon</a></li>
      
      <li><a href="https://simonaubury.com/categories/cat/" class="hamburger-menu-overlay-link">Cat</a></li>
      
      <li><a href="https://simonaubury.com/categories/cdc/" class="hamburger-menu-overlay-link">CDC</a></li>
      
      <li><a href="https://simonaubury.com/categories/duckdb/" class="hamburger-menu-overlay-link">duckdb</a></li>
      
      <li><a href="https://simonaubury.com/categories/flink/" class="hamburger-menu-overlay-link">flink</a></li>
      
      <li><a href="https://simonaubury.com/categories/generativeai/" class="hamburger-menu-overlay-link">GenerativeAI</a></li>
      
      <li><a href="https://simonaubury.com/categories/gpt/" class="hamburger-menu-overlay-link">GPT</a></li>
      
      <li><a href="https://simonaubury.com/categories/homeassistant/" class="hamburger-menu-overlay-link">homeassistant</a></li>
      
      <li><a href="https://simonaubury.com/categories/kafka/" class="hamburger-menu-overlay-link">Kafka</a></li>
      
      <li><a href="https://simonaubury.com/categories/ml/" class="hamburger-menu-overlay-link">ML</a></li>
      
      <li><a href="https://simonaubury.com/categories/raspberry-pi/" class="hamburger-menu-overlay-link">Raspberry Pi</a></li>
      
      <li><a href="https://simonaubury.com/categories/snowflake/" class="hamburger-menu-overlay-link">snowflake</a></li>
      
      <li><a href="https://simonaubury.com/index.xml" class="hamburger-menu-overlay-link">rss</a></li>
    </ul>
  </div>
</nav>

    <main class="content side-text-padding">
      <article class="post dropcase">
        <header class="post-header">
          <h1 class="post-title">Can ML predict where my cat is now — part 2</h1>
          <p class="post-date">Posted <time datetime="2022-07-01">Jul 1, 2022</time></p>
        </header>
        <picture class="post-figure">
          
          
          
          <source srcset="https://simonaubury.com/posts/202207_cat_predition2/00000007_hu7760b875ba46f0126be19016db5f23a3_243568_711x0_resize_lanczos_3.png 1x, https://simonaubury.com/posts/202207_cat_predition2/00000007_hu7760b875ba46f0126be19016db5f23a3_243568_1422x0_resize_lanczos_3.png 2x, https://simonaubury.com/posts/202207_cat_predition2/00000007_hu7760b875ba46f0126be19016db5f23a3_243568_2133x0_resize_lanczos_3.png 3x">
          <img src="https://simonaubury.com/posts/202207_cat_predition2/00000007_hu7760b875ba46f0126be19016db5f23a3_243568_711x0_resize_lanczos_3.png" >
        </picture>
        
        
        <h1 id="can-ml-predict-where-my-cat-is-nowpart-2">Can ML predict where my cat is now — part 2</h1>
<blockquote>
<p>Can ML predict where Snowy the cat would go throughout her day? With months of location &amp; temperature data captured, this second blogs covers how to train a machine learning (ML) model to predict where Snowy would go throughout her day. For the impatient, you can skip directly to the prediction web-app here.</p>
</blockquote>
<p><a href="/posts/202202_cat_predition1">Part 1 of this blog</a> covered the hardware required build a history of which room she used for her favourite sleeping spots.</p>
<p><img src="00000000.gif" alt="Cat location prediction using Streamlit web apps"></p>
<p><em>Cat location prediction using Streamlit web apps</em></p>
<h2 id="where-are-we-starting">Where are we starting?</h2>
<p>This <a href="/posts/202202_cat_predition1">first blog</a> described the the method for locating Snowy and data collection platform. I had collected over three months of location observations, with over <strong>12 million</strong> location, temperature, humidity and rainfall observations (I <em>may</em> have gone over the top with data collection).</p>
<p><img src="00000001.png" alt=""></p>
<p>The question I’ve been trying to answer, can I use these historic observations to build a prediction model of where she is likely to go? How confident can I be using a machine to predict where a cat is likely to be at predicting the hiding spot for Snowy?</p>
<h2 id="ml-bootcamp">ML Bootcamp</h2>
<p>Supervised learning is the ML task of creating a function that maps an input to an output based on example input-output pairs. In my case, I want to take historic observations about cat location, temperature, time of day etc., as inputs and find patterns … a function (inference) that predicts future cat location.</p>
<p><img src="00000002.png" alt="Temperature, time and day — can it map to location?"></p>
<p><em>Temperature, time and day — can it map to location?</em></p>
<p>My assumption is the problem can be generalised from this data; e.g. future data will follow some common pattern of past cat behaviour (for a cat — this assumption may be questionable) .</p>
<p><img src="00000003.png" alt="Cat location prediction"></p>
<p><em>Cat location prediction</em></p>
<p>The training uses past information to build a model that is a deployable artefact. Once a candidate model is trained, it can be tested for predication accuracy and finally deployed. In my case, I wish to create a web application to make predictions on where Snowy is likely to be napping.</p>
<p>What’s also important is that the model doesn’t have to explicitly output an absolute location, but can give its answer in terms of a confidence. If it output P(location:study) near 1.0 it’s confident, but values near 0.5 represent “unsure” about the confidence of predicting Snowy’s location.</p>
<h2 id="summarising-data-with-dbt">Summarising data with dbt</h2>
<p>As covered in <a href="https://simon-aubury.medium.com/can-ml-predict-where-my-cat-is-now-part-1-cfb194b51aab">part 1</a> — my data platform Home assistant stores each sensor update in the <a href="https://www.home-assistant.io/docs/backend/database/">states</a> table. This is *really *fine-grained, with updates added every few seconds from all the sensors (in my case, around 18,000 sensor updates a day). My goal was to summarise the data into hourly updates — essentially a single (most prevalent) location, along with temperature and humidity readings.</p>
<p><img src="00000004.png" alt="Summarising lots of data into hourly summaries"></p>
<p><em>Summarising lots of data into hourly summaries</em></p>
<p>Initially I was manually running the data processing with a bunch of SQL statements (like <a href="https://github.com/saubury/cat-predictor/blob/master/sql/extract.sql">this</a>) to process the data. However, I found this fairly cumbersome as I wanted to retraining the model with newer location and environmental conditions. I settled on using the trusty data engineering tool <a href="https://www.getdbt.com/">dbt</a> to simplify the creation of the SQL transformation in my database to make retraining more effective.</p>
<p><img src="00000005.png" alt="The dbt lineage graph showing the transformation of data"></p>
<p><em>The dbt lineage graph showing the transformation of data</em></p>
<p>dbt handles turning these my select statements into tables and views, performing the transforming data already inside of my postgres data warehouse.</p>
<h2 id="model-training--evaluation">Model training &amp; evaluation</h2>
<p>I used a Scikit-learn random <a href="https://www.datacamp.com/tutorial/random-forests-classifier-python">forest decision tree</a> classification for my predictive model. Random forests creates decision trees on randomly selected data samples, gets prediction from each tree and selects the best solution by means of voting. It also provides a pretty good indicator of the feature importance.</p>
<p>If you look at the <a href="https://github.com/saubury/cat-predict/tree/master/notebooks">python notebook</a> you can see the steps taken to assigns a class label to inputs, based on many examples it has been trained on from thousands of past observations of time of day, temperature and location.</p>
<p><img src="00000006.png" alt="Python code segment for visualizing feature importance"></p>
<p><em>Python code segment for visualizing feature importance</em></p>
<p>One really cool thing about the Scikit-learn decision tree models is how easy it is to visualise what’s going on. By visualizing the model features (above) I can see that “hour of the day” is the most significant feature in the model.</p>
<p>Intuitively this makes sense — time of day is likely to have the most significant impact on where Snowy is likely to be. The second most significant feature in predicting Snowy’s location is outside air temperature. Again this makes sense — too hot or too cold is likely to change is she wants to be outside. What I found surprising was the <em>least significant</em> feature was the is-raining feature. One possible explanation is the feature only makes sense during daylight hours, the is-raining won’t have an effect on the model when Snowy is sleeping inside at night.</p>
<p>It’s also possible to <a href="https://towardsdatascience.com/how-to-visualize-a-decision-tree-from-a-random-forest-in-python-using-scikit-learn-38ad2d75f21c">visualize a decision tree</a> from a random forest in Python using Scikit-Learn.</p>
<p><img src="00000007.png" alt="A visual decision tree showing the hour and day decision points"></p>
<p><em>A visual decision tree showing the hour and day decision points</em></p>
<p>Here in my display tree I can see the hour of the day is the initial decision point in the prediction — with 7:00am an interesting part of the algorithm. This is the time when alarm clocks go off in our household — and the cat is motivated to get up and look for food. Another interesting part of the tree is the “day of the week ≤ 5.5”. This equates to day of day of week being Monday through Friday — and again this part of the algorithm makes sense as we (and the cat) generally get up a bit later on week-ends</p>
<h2 id="the-cat-predictor-web-app-in-streamlit">The cat predictor web-app in Streamlit</h2>
<p>With the model created, I now wanted to build a web application to predict Snowy’s location based on a range of inputs. <a href="https://docs.streamlit.io/">Streamlit</a> is an open-source Python library that makes it easy to create web apps (without me having to learn a bunch of front-end frameworks). I added sliders and selection boxes to for feature values, such as day and temperature.</p>
<p><img src="00000008.png" alt="Web application — with inputs as slider controls"></p>
<p><em>Web application — with inputs as slider controls</em></p>
<p>And voila — with a bit more <a href="https://github.com/saubury/cat-predict-app/blob/master/cat_predictor_app.py">python code</a> I’ve created a Cat Prediction App; a web-app that predicts the likely location of Snowy the cat. I found some <a href="https://towardsdatascience.com/a-quick-tutorial-on-how-to-deploy-your-streamlit-app-to-heroku-874e1250dadd">excellent instruction</a>s to deploy my Streamlit app to Heroku. So I can now <a href="https://cat-predict-app.herokuapp.com/">share my Cap Predicator app</a> with the world!</p>
<h2 id="links-to-code">Links to code</h2>
<p>Hope you find this blog and code helpful for all your pet location prediction needs</p>
<ul>
<li>
<p>Data platform and ML prediction: <a href="https://github.com/saubury/cat-predict">https://github.com/saubury/cat-predict</a></p>
</li>
<li>
<p>Streamlit App: <a href="https://github.com/saubury/cat-predict-app">https://github.com/saubury/cat-predict-app</a></p>
</li>
</ul>

      </article>
      
    </main>
    <nav class="end-nav side-padding">
      
      <a ontouchstart="cardPressed.call(this)" ontouchend="cardReleased.call(this)" ontouchmove="cardReleased.call(this)" 
  href="https://simonaubury.com/posts/202202_cat_predition1/" class="card blog-card bc-next" rel="bookmark" >
  
  <div class="card-img-container">
    <p class="card-img-overlay">Next Article</p>
    <picture>
      
      
      
      <source srcset="https://simonaubury.com/posts/202202_cat_predition1/00000000_hu19a65958a728d3fdec9c186bf04684c0_493240_400x0_resize_lanczos_3.png 1x, https://simonaubury.com/posts/202202_cat_predition1/00000000_hu19a65958a728d3fdec9c186bf04684c0_493240_800x0_resize_lanczos_3.png 2x, https://simonaubury.com/posts/202202_cat_predition1/00000000_hu19a65958a728d3fdec9c186bf04684c0_493240_1200x0_resize_lanczos_3.png 3x">
      <img src="https://simonaubury.com/posts/202202_cat_predition1/00000000_hu19a65958a728d3fdec9c186bf04684c0_493240_400x0_resize_lanczos_3.png" class="card-img" >
    </picture>
  </div>
  
  <article class="card-body">
    <h2 class="card-title">Can ML predict where my cat is now — part 1</h2>
    <p class="card-text">I know I have a cat somewhere ...</p>
    <div class="card-subtext muted-text">
      <p>Posted <time datetime="2022-02-01">Feb 1, 2022</time></p>
      <p>#Raspberry Pi #Cat </p>
    </div>
  </article>
</a>
      
    </nav>
    <footer class="side-padding" style="background-image: url('https://simonaubury.com/img/home-blob-flip.svg');">
    <a href="https://simonaubury.com/" class="footer-link">
    
        <img class="footer-icon" src="https://simonaubury.com/icons/home.svg" alt="Home">
    
    </a>
    
    
    
    <a href="https://github.com/saubury" class="footer-link" target="_blank" rel="noopener noreferrer">
    
        <img class="footer-icon" src="https://simonaubury.com/icons/github.svg" alt="GitHub"/>
    
    </a>
    
    
    
    <a href="https://www.linkedin.com/in/simonaubury" class="footer-link" target="_blank" rel="noopener noreferrer">
    
        <img class="footer-icon" src="https://simonaubury.com/icons/linkedin.svg" alt="LinkedIn"/>
    
    </a>
    
    
    <a href="https://simonaubury.com/index.xml" class="footer-link" target="_blank" rel="noopener noreferrer">
    
        <img class="footer-icon" src="https://simonaubury.com/icons/rss.svg" alt="RSS"/>
    
    </a>
    
    
    
    
    
    
    
    
</footer>
    
  <script defer src="https://simonaubury.com/js/katex.min.js"></script>


  <script defer src="https://simonaubury.com/js/auto-render.min.js" onload="renderMathInElement(document.body);"></script>


<script src="https://simonaubury.com/js/core.min.js"></script>

  </body>
</html>
