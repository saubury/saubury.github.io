<!DOCTYPE html>
<html lang="en-au" dir="ltr">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Oracle to Kafka‚Ää‚Äî‚ÄäPlaying with Confluent‚Äôs new Oracle CDC Source Connector in Docker &middot; Simon Aubury</title>
  <meta name="description" content="Streaming Oracle data into Kafka" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://simonaubury.com/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://simonaubury.com/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://simonaubury.com/favicon-16x16.png">
  <link href="https://simonaubury.com/css/katex.min.css" rel="stylesheet">
  
  
  
  
  <link href="https://simonaubury.com/css/concated.min.css" rel="stylesheet">
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7N67PMRZ6N"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-7N67PMRZ6N', { 'anonymize_ip': false });
}
</script>

  
</head>

  <body class="single-body">
    <nav class="nav-bar side-padding">
  <h1 class="nav-header"><a href="https://simonaubury.com/" class="nav-text">simon aubury</a></h1>
  <div class="hamburger-menu">
    <input class="hamburger-menu-button" type="checkbox"
      onclick="hamburgerMenuPressed.call(this)"
      aria-label="Hamburger Menu Button"
    >
    <div class="hamburger-menu-icon">
      <span></span>
      <span></span>
    </div>
    <ul id="menu" class="hamburger-menu-overlay">
      <li><a href="https://simonaubury.com/" class="hamburger-menu-overlay-link">Home</a></li>
      <li><a href="https://simonaubury.com/slides/" class="hamburger-menu-overlay-link">Presentation slides</a></li>
      <li><a href="https://simonaubury.com/about-me/" class="hamburger-menu-overlay-link">About Simon</a></li>
      
      <li><a href="https://simonaubury.com/categories/cat/" class="hamburger-menu-overlay-link">Cat</a></li>
      
      <li><a href="https://simonaubury.com/categories/cdc/" class="hamburger-menu-overlay-link">CDC</a></li>
      
      <li><a href="https://simonaubury.com/categories/duckdb/" class="hamburger-menu-overlay-link">duckdb</a></li>
      
      <li><a href="https://simonaubury.com/categories/flink/" class="hamburger-menu-overlay-link">flink</a></li>
      
      <li><a href="https://simonaubury.com/categories/generativeai/" class="hamburger-menu-overlay-link">GenerativeAI</a></li>
      
      <li><a href="https://simonaubury.com/categories/gpt/" class="hamburger-menu-overlay-link">GPT</a></li>
      
      <li><a href="https://simonaubury.com/categories/homeassistant/" class="hamburger-menu-overlay-link">homeassistant</a></li>
      
      <li><a href="https://simonaubury.com/categories/kafka/" class="hamburger-menu-overlay-link">Kafka</a></li>
      
      <li><a href="https://simonaubury.com/categories/ml/" class="hamburger-menu-overlay-link">ML</a></li>
      
      <li><a href="https://simonaubury.com/categories/raspberry-pi/" class="hamburger-menu-overlay-link">Raspberry Pi</a></li>
      
      <li><a href="https://simonaubury.com/categories/snowflake/" class="hamburger-menu-overlay-link">snowflake</a></li>
      
      <li><a href="https://simonaubury.com/index.xml" class="hamburger-menu-overlay-link">rss</a></li>
    </ul>
  </div>
</nav>

    <main class="content side-text-padding">
      <article class="post dropcase">
        <header class="post-header">
          <h1 class="post-title">Oracle to Kafka‚Ää‚Äî‚ÄäPlaying with Confluent‚Äôs new Oracle CDC Source Connector in Docker</h1>
          <p class="post-date">Posted <time datetime="2021-02-18">Feb 18, 2021</time></p>
        </header>
        <picture class="post-figure">
          
          
          
          <source srcset="https://simonaubury.com/posts/202102_oracle_cdc_kafka/00000000_hu0ea297088302243dbdf50bdfb2624cf8_84383_711x0_resize_lanczos_3.png 1x, https://simonaubury.com/posts/202102_oracle_cdc_kafka/00000000_hu0ea297088302243dbdf50bdfb2624cf8_84383_1422x0_resize_lanczos_3.png 2x, https://simonaubury.com/posts/202102_oracle_cdc_kafka/00000000_hu0ea297088302243dbdf50bdfb2624cf8_84383_2133x0_resize_lanczos_3.png 3x">
          <img src="https://simonaubury.com/posts/202102_oracle_cdc_kafka/00000000_hu0ea297088302243dbdf50bdfb2624cf8_84383_711x0_resize_lanczos_3.png" >
        </picture>
        
        
        <h1 id="oracle-to-kafkaplaying-with-confluents-new-oracle-cdc-source-connector-in-docker">Oracle to Kafka‚Ää‚Äî‚ÄäPlaying with Confluent‚Äôs new Oracle CDC Source Connector in Docker</h1>
<p>It‚Äôs really exciting to have a new option for streaming Oracle data into Kafka. With Confluent releasing their ‚ÄúOracle CDC Source Premium Connector‚Äù there‚Äôs a new way to capture data that has been added to, updated, or deleted from Oracle RDBMS with Change Data Capture (CDC). Think of this as a low touch way to stream both the Oracle data and schema changes into Kafka and Schema Registry.</p>
<blockquote>
<p>I put together some <a href="https://github.com/saubury/kafka-connect-oracle-cdc">examples</a> so you can play with this entire pipeline in Docker. Docker is an easy-way to run a an end to end pipeline on your machine. I hope this demo gives you a glimpse of how Oracle CDC to Kafka works.</p>
</blockquote>
<p><img src="00000000.png" alt=""></p>
<p>‚ö†Ô∏è Some of these components are paid offerings üí∞ for production use. Both the <a href="https://www.oracle.com/downloads/licenses/standard-license.html">Oracle</a> and <a href="https://www.confluent.io/software-evaluation-license/">Confluent</a> license grant you free licence to play with this stuff as a developer for 30 days (disclaimer: I‚Äôm not a lawyer; nor do I play one on TV)</p>
<p>üõ† Code available at <a href="https://github.com/saubury/kafka-connect-oracle-cdc">https://github.com/saubury/kafka-connect-oracle-cdc</a></p>
<h2 id="kafka-connect-cdc-what-be-this">Kafka Connect, CDC‚Äî What be this?</h2>
<p><a href="https://docs.confluent.io/platform/current/connect/index.html">Kafka Connect</a> is an open source framework for streaming data between Apache Kafka and other data systems (such as databases). Confluent‚Äôs Oracle CDC Source Connector is a plug-in for Kafka Connect, which (surprise) connects Oracle as a source into Kafka as a destination.</p>
<p>This connector uses the <a href="https://docs.oracle.com/en/database/oracle/oracle-database/19/sutil/oracle-logminer-utility.html#GUID-3417B738-374C-4EE3-B15C-3A66E01AE2B5">Oracle LogMiner</a> interface to query online and archived redo log files. That‚Äôs an Oracle specific way to stream both the DML and DDL directly from the redo of the database. This is similar to how the <a href="https://debezium.io/">Debezium</a> project reads the Postgres write-ahead log or the MySQL binlog.</p>
<h3 id="why-not-just-use-the-oracle-jdbc-source-connector">Why not just use the Oracle JDBC Source Connector?</h3>
<p>Robin Moffatt has written a great article on <a href="https://www.confluent.io/blog/no-more-silos-how-to-integrate-your-databases-with-apache-kafka-and-cdc/">How to Integrate Your Databases with Apache Kafka</a> which provides a great discussion on the differences between a JDBC connector reading data from a database (such as Oracle) vs a log-based Change Data Capture (CDC) tool to extract changes.</p>
<p>The Oracle JDBC Connector is fine for getting a snapshot of a table. However, to identify changed or deleted rows with a JDBC connector is painful. Let‚Äôs just say you‚Äôll quickly fall into a murky world of putting triggers on tables to determine what has changed ‚Ä¶ and no-one wants to do that.</p>
<p>The Oracle CDC Source Connector on the other hand is essentially listening to the recovery redo segment of the database. This allows for <em>most</em> DML (insert, update, delete) and <em>some</em> DDL (alter table) database events to be captured an Oracle database and produced into into Kafka and the Schema Registry.</p>
<h3 id="oracle-versions">Oracle Versions</h3>
<p>Worth highlighting that when this blog was written, the connector works with Oracle 11g, 12c and 18c but <em>not</em> Oracle 19c. For this demonstration I‚Äôm using Oracle 12c with pluggable databases.</p>
<h2 id="lets-play">Let‚Äôs Play</h2>
<h3 id="clone-this-repo">Clone this repo</h3>
<pre><code>git clone [https://github.com/saubury/kafka-connect-oracle-cdc](https://github.com/saubury/kafka-connect-oracle-cdc)

cd kafka-connect-oracle-cdc
</code></pre>
<h2 id="get-oracle-cdc-source-connector">Get Oracle CDC Source Connector</h2>
<p>Be sure to review the license and <a href="https://www.confluent.io/hub/confluentinc/kafka-connect-oracle-cdc">download</a> the zip file for the Confluent Oracle CDC Source Connector</p>
<p>Unzip to confluentinc-kafka-connect-oracle-cdc (and remove any trailing version numbers)</p>
<pre><code>unzip ~/Downloads/confluentinc-kafka-connect-oracle-cdc-1.0.3.zip

mv confluentinc-kafka-connect-oracle-cdc-1.0.3 confluentinc-kafka-connect-oracle-cdc
</code></pre>
<h2 id="get-oracle-docker">Get Oracle Docker</h2>
<p>Credit to <a href="https://stackoverflow.com/questions/47887403/pull-access-denied-for-container-registry-oracle-com-database-enterprise">Stackoverflow</a> for explaining how to get Oracle working in Docker (well, at least in February 2021)</p>
<ul>
<li>
<p>log into <a href="https://hub.docker.com/">https://hub.docker.com/</a></p>
</li>
<li>
<p>search ‚Äúoracle database‚Äù</p>
</li>
<li>
<p>click on ‚ÄúOracle Database Enterprise Edition‚Äù</p>
</li>
<li>
<p>click on ‚ÄúProceed to Checkout‚Äù</p>
</li>
<li>
<p>fill in your contact info on the left, check two boxes under ‚ÄúDeveloper Tier‚Äù on the right, click on ‚ÄúGet Content‚Äù</p>
</li>
</ul>
<p>You should now be able to download an Oracle Docker image</p>
<pre><code>docker login --username YourDockerUserName --password-stdin
&lt;&lt;Enter your password&gt;&gt;

docker pull store/oracle/database-enterprise:12.2.0.1
</code></pre>
<h2 id="docker-startup">Docker Startup</h2>
<p>You‚Äôre all set to startup the platform (which will start Oracle, Kafka, Kafka Connect, Schema registry etc.,)</p>
<pre><code>docker-compose up -d
</code></pre>
<h2 id="setup-oracle-docker">Setup Oracle Docker</h2>
<p>Once the Oracle database is running, we need run a script to perform some setup. This SQL will turn on ARCHIVELOG mode, create some users, and establish permissions</p>
<p>First, ensure the database looks like it‚Äôs finished starting up (docker-compose logs -f oracle) and then run the following (for the curious, the SQL script is <a href="https://github.com/saubury/kafka-connect-oracle-cdc/blob/master/scripts/oracle_setup_docker.sql">here</a> )</p>
<pre><code>docker-compose exec oracle /scripts/go_sqlplus.sh /scripts/oracle_setup_docker
</code></pre>
<h2 id="sample-data">Sample Data</h2>
<p>This SQL script also creates an EMP table, and adds four employees.</p>
<p><img src="00000001.png" alt="The EMP table"><em>The EMP table</em></p>
<h3 id="connector-configuration">Connector Configuration</h3>
<p>Check the OracleCdcSourceConnector source plug-in is available</p>
<pre><code>curl -s -X GET -H 'Content-Type: application/json' http://localhost:8083/connector-plugins | jq '.'
</code></pre>
<p>And look for an occurrence of &ldquo;class&rdquo;: &ldquo;io.confluent.connect.oracle.cdc.OracleCdcSourceConnector&rdquo;</p>
<p>All good ‚Äî now it‚Äôs time to establish the SimpleOracleCDC connector. This configuration will initially snapshot the EMP table, and then listen to all redo activity (DML and DDL) against this table.</p>
<pre><code>curl -s -X POST -H 'Content-Type: application/json' --data @SimpleOracleCDC.json http://localhost:8083/connectors | jq
</code></pre>
<p>Check the status of the connector. You may need to wait a minute or so for the status to show up</p>
<pre><code>curl -s -X GET -H 'Content-Type: application/json' http://localhost:8083/connectors/SimpleOracleCDC/status | jq
</code></pre>
<h2 id="check-topic">Check topic</h2>
<p>If you have Kafka tools installed locally, you can look at the de-serialised AVRO like this</p>
<pre><code>kafka-avro-console-consumer --bootstrap-server localhost:9092 --topic ORCLCDB.C__MYUSER.EMP --from-beginning
</code></pre>
<p>Or if you don‚Äôt have the Kafka tools installed, you can launch kafka-avro-console-consumer via a container like (yes; this is all one line)</p>
<pre><code>docker-compose exec kafka-connect kafka-avro-console-consumer --bootstrap-server kafka:29092 --property schema.registry.url=&quot;http://schema-registry:8081&quot; --topic ORCLCDB.C__MYUSER.EMP --from-beginning
</code></pre>
<p>The (simplified) output of kafka-avro-console-consumer should look something like. Four rows initially from the table are four records in Kafka</p>
<pre><code>{&quot;I&quot;:&quot;\u0001&quot;,&quot;NAME&quot;:{&quot;string&quot;:&quot;Bob&quot;}}
{&quot;I&quot;:&quot;\u0002&quot;,&quot;NAME&quot;:{&quot;string&quot;:&quot;Jane&quot;}}
{&quot;I&quot;:&quot;\u0003&quot;,&quot;NAME&quot;:{&quot;string&quot;:&quot;Mary&quot;}}
{&quot;I&quot;:&quot;\u0004&quot;,&quot;NAME&quot;:{&quot;string&quot;:&quot;Alice&quot;}}
</code></pre>
<h2 id="schema">Schema</h2>
<p>Let‚Äôs see what schemas we have registered for the EMP table</p>
<pre><code>curl -s -X GET http://localhost:8081/subjects/ORCLCDB.C__MYUSER.EMP-value/versions/1 | jq -r .schema | jq .
</code></pre>
<p>Amongst other things, you‚Äôll see version 1 of the schema has been registered like this</p>
<pre><code>&quot;fields&quot;: [
    {
      &quot;name&quot;: &quot;I&quot;,
      &quot;type&quot;: {
        &quot;type&quot;: &quot;bytes&quot;
    },
    {
      &quot;name&quot;: &quot;NAME&quot;,
      &quot;type&quot;: [
        &quot;string&quot;
      ]
    }
</code></pre>
<h2 id="insert-update-and-delete-some-data">Insert, update and delete some data</h2>
<p>Let‚Äôs now insert more data, and try some updates and a delete.</p>
<p>Run docker-compose exec oracle /scripts/go_sqlplus.sh followed by this SQL</p>
<pre><code>insert into C##MYUSER.emp (name) values ('Dale');
insert into C##MYUSER.emp (name) values ('Emma');
update C##MYUSER.emp set name = 'Robert' where name = 'Bob';
delete C##MYUSER.emp where name = 'Jane';
commit;
exit
</code></pre>
<h2 id="updated-sample-data">Updated Sample Data</h2>
<p>This adds 2 rows to EMP table, updates 1 row, and deletes 1 row.</p>
<p><img src="00000002.png" alt="Updated EMP table"><em>Updated EMP table</em></p>
<p>The (simplified) output of <em>kafka-avro-console-consumer</em> should look something like</p>
<pre><code>{&quot;I&quot;:&quot;\u0005&quot;,&quot;NAME&quot;:{&quot;string&quot;:&quot;Dale&quot;},&quot;op_type&quot;:{&quot;string&quot;:&quot;I&quot;}}
{&quot;I&quot;:&quot;\u0006&quot;,&quot;NAME&quot;:{&quot;string&quot;:&quot;Emma&quot;},&quot;op_type&quot;:{&quot;string&quot;:&quot;I&quot;}}
{&quot;I&quot;:&quot;\u0001&quot;,&quot;NAME&quot;:{&quot;string&quot;:&quot;Robert&quot;},&quot;op_type&quot;:{&quot;string&quot;:&quot;U&quot;}}
{&quot;I&quot;:&quot;\u0002&quot;,&quot;NAME&quot;:{&quot;string&quot;:&quot;Jane&quot;},&quot;op_type&quot;:{&quot;string&quot;:&quot;D&quot;}
</code></pre>
<h2 id="ddl">DDL</h2>
<p>So far we‚Äôve seen DML applied to a table. Now let‚Äôs try some DDL to modify a table.</p>
<p>Run docker-compose exec oracle /scripts/go_sqlplus.sh followed by this SQL</p>
<pre><code>ALTER TABLE C##MYUSER.EMP ADD (SURNAME VARCHAR2(100));

insert into C##MYUSER.emp (name, surname) values ('Mickey', 'Mouse');
commit;
</code></pre>
<h2 id="updated-sample-data-1">Updated Sample Data</h2>
<p>Our new row looks like this (note the new surname column)</p>
<p><img src="00000003.png" alt="DDL applied to EMP table"><em>DDL applied to EMP table</em></p>
<h3 id="schema-mutation">Schema mutation</h3>
<p>Let‚Äôs see what schemas we have registered now.</p>
<pre><code>curl -s -X GET http://localhost:8081/subjects/ORCLCDB.C__MYUSER.EMP-value/versions
</code></pre>
<p>Will show [1,2] ‚Äî indicating two versions of the schema are available. We have data registered against version 1 and version 2 of the schema</p>
<pre><code>curl -s -X GET http://localhost:8081/subjects/ORCLCDB.C__MYUSER.EMP-value/versions/2 | jq -r .schema | jq .
</code></pre>
<p>Note, schema version 2 has this addition</p>
<pre><code>{
      &quot;name&quot;: &quot;SURNAME&quot;,
      &quot;type&quot;: [
        &quot;null&quot;,
        &quot;string&quot;
      ],
      &quot;default&quot;: null
    }
</code></pre>
<h3 id="tear-down">Tear Down</h3>
<p>To tear down the containers</p>
<pre><code>docker-compose down
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>Capturing data from an Oracle database into Kafka is a really common request. Having a Confluent supported CDC Source Connector is a great option to consider when you require a low touch way to stream both the Oracle data and schema changes into Kafka and Schema Registry.</p>
<p>Oh, and Docker is awesome !</p>
<h2 id="references">References</h2>
<ul>
<li>
<p><a href="https://www.confluent.io/hub/confluentinc/kafka-connect-oracle-cdc">Oracle CDC Source Connector</a></p>
</li>
<li>
<p><a href="https://docs.confluent.io/kafka-connect-oracle-cdc/current/configuration-properties.html">Oracle CDC Source Connector Configuration Properties</a></p>
</li>
<li>
<p><a href="https://www.confluent.io/blog/no-more-silos-how-to-integrate-your-databases-with-apache-kafka-and-cdc/">How to Integrate Your Databases with Apache Kafka</a></p>
</li>
<li>
<p><a href="https://github.com/saubury/kafka-connect-oracle-cdc">https://github.com/saubury/kafka-connect-oracle-cdc</a></p>
</li>
</ul>

      </article>
      
    </main>
    <nav class="end-nav side-padding">
      
      <a ontouchstart="cardPressed.call(this)" ontouchend="cardReleased.call(this)" ontouchmove="cardReleased.call(this)" 
  href="https://simonaubury.com/posts/202102_1cat3cloudspart2/" class="card blog-card bc-next" rel="bookmark" >
  
  <div class="card-img-container">
    <p class="card-img-overlay">Next Article</p>
    <picture>
      
      
      
      <source srcset="https://simonaubury.com/posts/202102_1cat3cloudspart2/00000000_huf3feb0dc709262d680a95f596b8036ce_177248_400x0_resize_lanczos_3.png 1x, https://simonaubury.com/posts/202102_1cat3cloudspart2/00000000_huf3feb0dc709262d680a95f596b8036ce_177248_800x0_resize_lanczos_3.png 2x, https://simonaubury.com/posts/202102_1cat3cloudspart2/00000000_huf3feb0dc709262d680a95f596b8036ce_177248_1200x0_resize_lanczos_3.png 3x">
      <img src="https://simonaubury.com/posts/202102_1cat3cloudspart2/00000000_huf3feb0dc709262d680a95f596b8036ce_177248_400x0_resize_lanczos_3.png" class="card-img" >
    </picture>
  </div>
  
  <article class="card-body">
    <h2 class="card-title">Cat tracking with Amazon Web Services‚Äî AWS IoT, DynamoDB and SageMaker</h2>
    <p class="card-text">Cat tracking with AWS</p>
    <div class="card-subtext muted-text">
      <p>Posted <time datetime="2021-02-04">Feb 4, 2021</time></p>
      <p>#Raspberry Pi #Cat </p>
    </div>
  </article>
</a>
      
    </nav>
    <footer class="side-padding" style="background-image: url('https://simonaubury.com/img/home-blob-flip.svg');">
    <a href="https://simonaubury.com/" class="footer-link">
    
        <img class="footer-icon" src="https://simonaubury.com/icons/home.svg" alt="Home">
    
    </a>
    
    
    
    <a href="https://github.com/saubury" class="footer-link" target="_blank" rel="noopener noreferrer">
    
        <img class="footer-icon" src="https://simonaubury.com/icons/github.svg" alt="GitHub"/>
    
    </a>
    
    
    
    <a href="https://www.linkedin.com/in/simonaubury" class="footer-link" target="_blank" rel="noopener noreferrer">
    
        <img class="footer-icon" src="https://simonaubury.com/icons/linkedin.svg" alt="LinkedIn"/>
    
    </a>
    
    
    <a href="https://simonaubury.com/index.xml" class="footer-link" target="_blank" rel="noopener noreferrer">
    
        <img class="footer-icon" src="https://simonaubury.com/icons/rss.svg" alt="RSS"/>
    
    </a>
    
    
    
    
    
    
    
    
</footer>
    
  <script defer src="https://simonaubury.com/js/katex.min.js"></script>


  <script defer src="https://simonaubury.com/js/auto-render.min.js" onload="renderMathInElement(document.body);"></script>


<script src="https://simonaubury.com/js/core.min.js"></script>

  </body>
</html>
