<!DOCTYPE html>
<html lang="en-au" dir="ltr">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Puppy data &middot; Simon Aubury</title>
  <meta name="description" content="🐾 Puppy Data 🐾 combines a love of data and dogs — a project to track Barney the puppy" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://simonaubury.com/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://simonaubury.com/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://simonaubury.com/favicon-16x16.png">
  <link href="https://simonaubury.com/css/katex.min.css" rel="stylesheet">
  
  
  
  
  <link href="https://simonaubury.com/css/concated.min.css" rel="stylesheet">
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7N67PMRZ6N"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-7N67PMRZ6N', { 'anonymize_ip': false });
}
</script>

  
</head>

  <body class="single-body">
    <nav class="nav-bar side-padding">
  <h1 class="nav-header"><a href="https://simonaubury.com/" class="nav-text">simon aubury</a></h1>
  <div class="hamburger-menu">
    <input class="hamburger-menu-button" type="checkbox"
      onclick="hamburgerMenuPressed.call(this)"
      aria-label="Hamburger Menu Button"
    >
    <div class="hamburger-menu-icon">
      <span></span>
      <span></span>
    </div>
    <ul id="menu" class="hamburger-menu-overlay">
      <li><a href="https://simonaubury.com/" class="hamburger-menu-overlay-link">Home</a></li>
      <li><a href="https://simonaubury.com/slides/" class="hamburger-menu-overlay-link">Presentation slides</a></li>
      <li><a href="https://simonaubury.com/about-me/" class="hamburger-menu-overlay-link">About Simon</a></li>
      
      <li><a href="https://simonaubury.com/categories/cat/" class="hamburger-menu-overlay-link">Cat</a></li>
      
      <li><a href="https://simonaubury.com/categories/cdc/" class="hamburger-menu-overlay-link">CDC</a></li>
      
      <li><a href="https://simonaubury.com/categories/duckdb/" class="hamburger-menu-overlay-link">duckdb</a></li>
      
      <li><a href="https://simonaubury.com/categories/flink/" class="hamburger-menu-overlay-link">flink</a></li>
      
      <li><a href="https://simonaubury.com/categories/generativeai/" class="hamburger-menu-overlay-link">GenerativeAI</a></li>
      
      <li><a href="https://simonaubury.com/categories/gpt/" class="hamburger-menu-overlay-link">GPT</a></li>
      
      <li><a href="https://simonaubury.com/categories/homeassistant/" class="hamburger-menu-overlay-link">homeassistant</a></li>
      
      <li><a href="https://simonaubury.com/categories/kafka/" class="hamburger-menu-overlay-link">Kafka</a></li>
      
      <li><a href="https://simonaubury.com/categories/ml/" class="hamburger-menu-overlay-link">ML</a></li>
      
      <li><a href="https://simonaubury.com/categories/raspberry-pi/" class="hamburger-menu-overlay-link">Raspberry Pi</a></li>
      
      <li><a href="https://simonaubury.com/categories/snowflake/" class="hamburger-menu-overlay-link">snowflake</a></li>
      
      <li><a href="https://simonaubury.com/index.xml" class="hamburger-menu-overlay-link">rss</a></li>
    </ul>
  </div>
</nav>

    <main class="content side-text-padding">
      <article class="post dropcase">
        <header class="post-header">
          <h1 class="post-title">Puppy data</h1>
          <p class="post-date">Posted <time datetime="2025-02-15">Feb 15, 2025</time></p>
        </header>
        <picture class="post-figure">
          
          
          
          <source srcset="https://simonaubury.com/posts/202502_puppydata/00000000_hu4efc0301962280752544e46501bacae3_327072_711x0_resize_lanczos_3.png 1x, https://simonaubury.com/posts/202502_puppydata/00000000_hu4efc0301962280752544e46501bacae3_327072_1422x0_resize_lanczos_3.png 2x, https://simonaubury.com/posts/202502_puppydata/00000000_hu4efc0301962280752544e46501bacae3_327072_2133x0_resize_lanczos_3.png 3x">
          <img src="https://simonaubury.com/posts/202502_puppydata/00000000_hu4efc0301962280752544e46501bacae3_327072_711x0_resize_lanczos_3.png" >
        </picture>
        
        
        <h1 id="puppy-data">Puppy data</h1>
<p>🐾 Puppy Data 🐾 combines a love of data and dogs — a project to track Barney the puppy🐶! Using load-cells and low power motion tracking sensors I built an automated system to monitor Barney’s weight, sleep habits, and activity📊. Data is sent to Home Assistant for easy tracking via a slick interface 📱. CotexAI and a Streamlit application allows me to ask questions like “How much heavier is Barney this month?” or “When was he most active?” 🐕💡. A blend of IoT, DIY tech, and puppy love ❤️📈!</p>
<p>This is Barney — our (now) 6 month old “Staffy Cross” — adopted from a local shelter. We love Barney joining our family— and I love data. Barney has agreed (sort of) to help with a local bit of data gathering so we can watch him grow.</p>
<p><img src="./00000000.png" alt="Barney at home — along with sample analytics"><em>Barney at home — along with sample analytics</em></p>
<p>My goal with this project was to passively collect data on Barney’s activity — his sleeping habits, weight gain, sleep patterns and movements around our house. The data is fed into data warehouse where a conversational interface is used to interact with my Barney data to answer questions like “When was Barney the most active yesterday?”, “How much heavier is Barney this month?” or “Where did Barney put my shoe?” (okay — maybe it didn’t help with that last one).</p>
<h2 id="puppy-weight">Puppy weight</h2>
<p>Puppies grow quickly — and I wanted an automated way of measuring his weight each day. On the underside of Barney’s kennel ( the “Barn” ! ) I installed 4 load cell weighing sensors — one for each corner of the Barney’s Barn. By summing the combined weight across the 4 cells and subtracting the <a href="https://en.wikipedia.org/wiki/Tare_weight">tare weight</a> (of the kennel itself and any cushions or toys dragged into the Barn overnight) I can determine an accurate daily weight for our puppy.</p>
<p>Load cells are pretty neat. They measure weight (or, more accurately, directional force). Each load cell is able to measure the electrical resistance that changes in response to (and is proportional to) the force applied. As Barney jumps into his Barn, we can instant weigh him — and as a bonus also measure the time he spends napping in his kennel.</p>
<p><img src="./00000001.png" alt="Close up a load cell and 3D printed mounting bracket"><em>Close up a load cell and 3D printed mounting bracket</em></p>
<p>The <a href="https://www.aliexpress.com/item/32968926628.html">50kg load cells and HX711</a> amplifier module was around $5. The peculiar thing about these sensors is they don’t sit flush to a surface of the barn, and the centre of each sensor needs a gap for it to flex when a load is applied. Searching online I found you can 3D print <a href="https://www.thingiverse.com/thing:2274593">a bracket</a> to help keep it clear of the underside to avoid this problem.</p>
<p><img src="./00000002.png" alt="HX711 amplifier module (left) and ESP32 (right)"><em>HX711 amplifier module (left) and ESP32 (right)</em></p>
<p>I wired the four load cells into a single circuit with the HX711 amplifier module in a <a href="https://en.wikipedia.org/wiki/Wheatstone_bridge">wheatstone bridge</a> configuration — have a look at <a href="https://circuitjournal.com/50kg-load-cells-with-HX711">this helpful blog</a> for the detailed steps.</p>
<p><img src="./00000003.png" alt="Underside of barn — with load cells and circuitry"><em>Underside of barn — with load cells and circuitry</em></p>
<p>Finally I was ready to connect the load cells and HX711 amplifier module into an <a href="https://www.aliexpress.com/gcp/300000512/nnmixupdatev3?spm=a2g0o.productlist.main.1.30ec7404w2UU6n&amp;productIds=1005006336964908&amp;pha_manifest=ssr&amp;_immersiveMode=true&amp;disableNav=YES&amp;channelLinkTag=nn_newgcp&amp;sourceName=mainSearchProduct&amp;utparam-url=scene%3Asearch%7Cquery_from%3A">ESP32</a> microcontrollers with integrated Wi-Fi and Bluetooth. Everything was taped to the underside of the barn — and the delicate wires and circuit boards hidden from the curious pup.</p>
<p><img src="./00000004.png" alt="Barney — passionate data producer"><em>Barney — passionate data producer</em></p>
<p>I flashed the ESP32 with <a href="https://esphome.io/">ESPHome</a> and added the <a href="https://esphome.io/components/sensor/hx711.html">HX711</a> sensor platform configuration.</p>
<pre><code>sensor:
  - platform: hx711
    name: &quot;HX711 Value&quot;
    dout_pin: GPIO14
    clk_pin: GPIO13
    gain: 128
    update_interval: 15s   
    filters: 
    - calibrate_linear:
        - -455742 -&gt; 0
        - -550682 -&gt; 4.404
    unit_of_measurement: kg
    accuracy_decimals: 1
</code></pre>
<p>The weight was captured “as-is” — and I did some SQL post processing to work out the tare weight. The final sensor then got added to <a href="https://www.home-assistant.io/">Home Assistant</a>, giving me monitoring, persistent storage and a nice use interface (and app) which I can use anywhere I’ve got an internet connection. Behind the scenes a local PostgreSQL database is used to store all the sensor measurements every minute.</p>
<p><img src="./00000005.png" alt="Home assistant dashboard"><em>Home assistant dashboard</em></p>
<p>With weight measurement sorted, I then set out to measure Barney’s activity tracking.</p>
<h2 id="puppy-activity">Puppy activity</h2>
<p>Barney rarely keeps still — so I wanted a way to track his movements during the day and sleep patterns at night. I got him <a href="https://www.fitbark.com/en-AU/store/fitbark2">FitBark 2</a> and placed it on his collar to monitor his everyday activity. This is a small 3D accelerometer and Bluetooth transmitter that weights only 10 grams! This is a very cool device — and it has a <a href="https://www.fitbark.com/en-AU/dev">developer API</a>!</p>
<p><img src="./00000006.png" alt="Barney with Fitbark on his collar"><em>Barney with Fitbark on his collar</em></p>
<p>I used the Home Assistant <a href="https://www.home-assistant.io/integrations/rest">rest sensor</a> platform to consume the Fitbark RESTful API.</p>
<pre><code>rest:
  - authentication: digest
    verify_ssl: false
    # update every 1 hour
    scan_interval: 3600
    resource: https://app.fitbark.com/api/v2/activity_series
    method: POST
    payload_template: &gt;-
      {   
        &quot;activity_series&quot;:{&quot;slug&quot;:&quot;XXxxXXxx&quot;,           
          &quot;from&quot;:&quot;{{ now().strftime('%Y-%m-%d') }}&quot;,           
          &quot;to&quot;:&quot;{{ now().strftime('%Y-%m-%d') }}&quot;,           
          &quot;resolution&quot;:&quot;HOURLY&quot;   
        }
      }
    headers:
      Authorization: !secret fitbark_bearer_token
      Content-Type: application/json
      User-Agent: Mozilla/5.0
    sensor:
      - name: &quot;Fitbark_activityseries_activity_value&quot;
        unique_id: fitbark_activityseries_activity_value
        value_template: &quot;{{ value_json.activity_series.records[-2].activity_value | int }}&quot; 
        
      - name: &quot;Fitbark_activityseries_min_play&quot;
        unique_id: fitbark_activityseries_min_play
        device_class: duration
        unit_of_measurement: min
        value_template: &quot;{{ value_json.activity_series.records[-2].min_play | int }}&quot;
</code></pre>
<p>The sensor has support for GET and POST requests, and I used the <a href="https://documenter.getpostman.com/view/238826/2s8ZDbW1Gf#7cde488a-ff03-4401-9658-207f7531a6ee">Get Activity Series</a> API to get the recent hourly activity for Barney, giving me a breakdown of his active, play and rest minutes.</p>
<p><img src="./00000007.png" alt="Activity by hour"><em>Activity by hour</em></p>
<p>Much like the weight measurements, the hourly activity measures are managed by Home Assistant which automatically stores the sensor measurements to a local PostgreSQL database.</p>
<p>With Barney weight and activity data captured let’s moved onto data analysis.</p>
<h2 id="cortex-analyst-in-snowflake">Cortex Analyst in Snowflake</h2>
<p>Barney had given me a lot of data — and now I wanted to do something with it! I’ve been using <a href="https://docs.snowflake.com/user-guide/snowflake-cortex/cortex-analyst">Cortex Analyst</a> in <a href="https://www.snowflake.com/en/">Snowflake</a> database in my “day job” and thought it was an ideal way of asking questions in natural language about Barney and receiving direct answers without writing SQL.</p>
<p>Cortex Analyst is a fully-managed, LLM-powered <a href="https://www.snowflake.com/en/data-cloud/cortex/">Snowflake Cortex</a> feature that helps you create applications capable of answering questions based on your data stored in Snowflake. So Cortex Analyst wil be tasked with answering the “Is Barney playing more this week?” style of questions in natural language and receive direct answers without writing SQL.</p>
<p>Here’s a look at Streamlit conversational application.</p>
<p>I can start asking questioons such as</p>
<blockquote>
<p>What was Barney’s smallest weight and when was that measured?</p>
</blockquote>
<p>Barney used be be such a tiny puppy! Let’s look at his growth</p>
<blockquote>
<p>Show me the weekly average weight of Barney for the last 3 months.</p>
</blockquote>
<p><img src="./00000010.png" alt="Barney has grown a lot over 3 months"><em>Barney has grown a lot over 3 months</em></p>
<p>Barney really has grown a lot over the last 3 months. Finally, let’s look at his activity</p>
<blockquote>
<p>Pivot the activity type for Barny and summarise the minutes each week for the last month.</p>
</blockquote>
<p><img src="./00000011.png" alt="Lots of play time!"><em>Lots of play time!</em></p>
<p>I see Barney enjoys his naps — and loves to run around too</p>
<h2 id="lessons--future-enhancements">Lessons &amp; future enhancements</h2>
<p>I’ve been happy with the Barney data collected so far — but a few things haven’t worked as expected</p>
<ul>
<li>
<p>The “food scale” which I initially created to weigh the food consumed was too impractical — as we kept moving the feeding bowl and Barney would often chew on the wires</p>
</li>
<li>
<p>The FitBark API call from Home Assistant is a delicate— requiring me to request specific blocks of time and has no error or retry logic. I’d prefer to rework this as a proper backfill operator</p>
</li>
<li>
<p>I originally wanted to use the signal strength (RSSI value) of the FitBark bluetooth as a proxy for location — however this was too imprecise for any meaningful measurements</p>
</li>
<li>
<p>The data transfer from local PostgreSQL to cloud Snowflake was manual — I’d like to automate this (and perhaps play with <a href="https://dlthub.com/">dlt</a>)</p>
</li>
</ul>
<p>What did work and I was happy with</p>
<ul>
<li>
<p>The weight scale worked better than expect — with (what appears to be) a smooth progressive and reliable weight measurement over the last few months</p>
</li>
<li>
<p>FitBark has an impressive data logging mechanism — and the battery has only been charged once in 6 months!</p>
</li>
</ul>
<p>In the end, <em>Puppy Data</em> showcases how IoT and puppy energy can turn a love for dogs and data into a fun way to track Barney’s growth and adventures, proving that even tech can have a heart ❤️🐾📊!</p>
<h3 id="code">Code</h3>
<p>The code and example data is available at</p>
<ul>
<li><a href="https://github.com/saubury/puppy_data">https://github.com/saubury/puppy_data</a></li>
</ul>
<h3 id="references">References</h3>
<ul>
<li>
<p><a href="https://esphome.io/guides/getting_started_hassio.html">Getting Started with ESPHome and Home Assistant</a></p>
</li>
<li>
<p><a href="https://quickstarts.snowflake.com/guide/getting_started_with_cortex_analyst_in_snowflake/index.html">Getting Started with Cortex Analyst in Snowflake</a></p>
</li>
</ul>

      </article>
      
    </main>
    <nav class="end-nav side-padding">
      
      <a ontouchstart="cardPressed.call(this)" ontouchend="cardReleased.call(this)" ontouchmove="cardReleased.call(this)" 
  href="https://simonaubury.com/posts/202405_fridgebot/" class="card blog-card bc-next" rel="bookmark" >
  
  <div class="card-img-container">
    <p class="card-img-overlay">Next Article</p>
    <picture>
      
      
      
      <source srcset="https://simonaubury.com/posts/202405_fridgebot/00000000_huf8c95e3659be74e80a47f3df041d0fe4_115318_400x0_resize_lanczos_3.png 1x, https://simonaubury.com/posts/202405_fridgebot/00000000_huf8c95e3659be74e80a47f3df041d0fe4_115318_800x0_resize_lanczos_3.png 2x, https://simonaubury.com/posts/202405_fridgebot/00000000_huf8c95e3659be74e80a47f3df041d0fe4_115318_1200x0_resize_lanczos_3.png 3x">
      <img src="https://simonaubury.com/posts/202405_fridgebot/00000000_huf8c95e3659be74e80a47f3df041d0fe4_115318_400x0_resize_lanczos_3.png" class="card-img" >
    </picture>
  </div>
  
  <article class="card-body">
    <h2 class="card-title">FridgeBot — GPT-4o shopping list automation</h2>
    <p class="card-text">GPT-4o shopping list automation - no excuse to forget the milk</p>
    <div class="card-subtext muted-text">
      <p>Posted <time datetime="2024-05-15">May 15, 2024</time></p>
      <p>#GenerativeAI #GPT </p>
    </div>
  </article>
</a>
      
    </nav>
    <footer class="side-padding" style="background-image: url('https://simonaubury.com/img/home-blob-flip.svg');">
    <a href="https://simonaubury.com/" class="footer-link">
    
        <img class="footer-icon" src="https://simonaubury.com/icons/home.svg" alt="Home">
    
    </a>
    
    
    
    <a href="https://github.com/saubury" class="footer-link" target="_blank" rel="noopener noreferrer">
    
        <img class="footer-icon" src="https://simonaubury.com/icons/github.svg" alt="GitHub"/>
    
    </a>
    
    
    
    <a href="https://www.linkedin.com/in/simonaubury" class="footer-link" target="_blank" rel="noopener noreferrer">
    
        <img class="footer-icon" src="https://simonaubury.com/icons/linkedin.svg" alt="LinkedIn"/>
    
    </a>
    
    
    <a href="https://simonaubury.com/index.xml" class="footer-link" target="_blank" rel="noopener noreferrer">
    
        <img class="footer-icon" src="https://simonaubury.com/icons/rss.svg" alt="RSS"/>
    
    </a>
    
    
    
    
    
    
    
    
</footer>
    
  <script defer src="https://simonaubury.com/js/katex.min.js"></script>


  <script defer src="https://simonaubury.com/js/auto-render.min.js" onload="renderMathInElement(document.body);"></script>


<script src="https://simonaubury.com/js/core.min.js"></script>

  </body>
</html>
