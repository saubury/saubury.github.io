<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Pi Peripheral - Controlling computer actions with a $10 Raspberry Pi Zero</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://simonaubury.com/index.xml">
		<link rel="canonical" href="https://simonaubury.com/202009_piperipheral/post/">
		
		<link rel="shortcut icon" type="image/png" href="https://simonaubury.com/apple-touch-icon-precomposed.png">
		
		
		<meta name="generator" content="Hugo 0.68.3" />

		
		<meta property="og:title" content="Pi Peripheral - Controlling computer actions with a $10 Raspberry Pi Zero" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://simonaubury.com/202009_piperipheral/00000003.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://simonaubury.com/202009_piperipheral/post/" />
		<meta property="og:site_name" content="Pi Peripheral - Controlling computer actions with a $10 Raspberry Pi Zero" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://simonaubury.com/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://simonaubury.com/css/story.css" />
		<link rel="stylesheet" href="https://simonaubury.com/css/descartes.css" />
		
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://simonaubury.com/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-202009_piperipheral page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://simonaubury.com/202009_piperipheral/00000003.jpeg'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://simonaubury.com/" title="Home">
						<img src="https://simonaubury.com/img/logo.jpg" class="w2 h2 br-100" alt="Simon Aubury Site" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/simonaubury/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/saubury/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/simonaubury/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://simonaubury.com/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://simonaubury.com/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">Pi Peripheral - Controlling computer actions with a $10 Raspberry Pi Zero</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2020-09-21T12:00:00&#43;11:00">Sep 21, 2020</time>
								<span class="display-print">by </span>
								
								<span class="display-print">at https://simonaubury.com/202009_piperipheral/post/</span>
							
						
					</h2>
				</div>

				
				
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links mw7">
	<h1 id="pi-peripheral">Pi Peripheral</h1>
<p>Landing gear down and strobe lights active. How to add physical buttons, switches and dials to control computer actions with a $10 Raspberry Pi Zero.</p>
<p>Why would you want to do this? Well you might want to add some additional buttons or switches to your favorite game. Or maybe you can streamline your video production but switching cameras with a foot pedal. For me, I wanted to add tactile controls to <em>Microsoft Flight Simulator 2020</em>. Switches for the landing gear, beacons and lights.</p>
<p>Project code at — <a href="https://github.com/saubury/pi-peripheral/">https://github.com/saubury/pi-peripheral/</a></p>
<p><img src="/202009_piperipheral/00000000.gif" alt="Animated GIF showing box in usage"><em>Animated GIF showing box in usage</em></p>
<p>In short, <em>Pi Peripheral</em> can be used to control close to any keyboard activated activity — anywhere where physical controls are preferable to using a keyboard.</p>
<h2 id="pi-peripheral--hardware">Pi Peripheral — Hardware</h2>
<p>A Raspberry Pi Zero board acts as a HID (Human Interface Device) device — pretending to be a USB keyboard. Python code generates key-presses when GPIO events are triggered. With basic wiring, the Raspberry Pi has 28 GPIO pins suitable for controlling actions.</p>
<h2 id="wiring">Wiring</h2>
<p>The Raspberry Pi is very easy to wire up to switches and push buttons. Each only requires a single connection to a spare GPIO pin, and a common ground. Software will configure the GPIO pin as an input. There is no need to a physical pull up resistor — this can be configured in software.</p>
<p><img src="/202009_piperipheral/00000001.png" alt="Wiring of GPIO"><em>Wiring of GPIO</em></p>
<h2 id="power">Power</h2>
<p>Both power and USB host (USB OTG) are provided by a single micro-USB port. Use the port labeled “USB” (<em>not</em> the one labeled “Power”).</p>
<p><img src="/202009_piperipheral/00000002.jpeg" alt="Wiring of GPIO"><em>Wiring of GPIO</em></p>
<h2 id="box-enclosure">Box Enclosure</h2>
<p>You can be creative here — I just picked a generic project box which was easy mount the switches and push buttons.</p>
<p><img src="/202009_piperipheral/00000003.jpeg" alt="Outside view of box"><em>Outside view of box</em></p>
<h2 id="pi-peripheral--software">Pi Peripheral — Software</h2>
<h2 id="configure-raspberry-pi-zero-as-a-usb-keyboard">Configure Raspberry Pi Zero as a USB Keyboard</h2>
<p>The first software task is configure the Raspberry Pi Zero to act as a USB Keyboard (HID input device.) These steps have largely been inspired from <a href="https://randomnerdtutorials.com/raspberry-pi-zero-usb-keyboard-hid/">randomnerdtutorials</a> which has more detailed steps should you run into problems.</p>
<pre><code>echo &quot;dtoverlay=dwc2&quot; | sudo tee -a /boot/config.txt
echo &quot;dwc2&quot; | sudo tee -a /etc/modules
echo &quot;libcomposite&quot; | sudo tee -a /etc/modules

sudo cp scripts/isticktoit_usb /usr/bin
sudo chmod +x /usr/bin/isticktoit_usb 
</code></pre>
<p>Add this line to the second-last line of /etc/rc.local (just before the line containing exit 0)</p>
<pre><code>/usr/bin/isticktoit_usb # This line new
exit 0
</code></pre>
<h2 id="installing-the-pi-peripheral-on-your-pc">Installing the Pi Peripheral on your PC</h2>
<p>All going well, you can not connect the <em>Pi Peripheral</em> and it should be identified as a keyboard. This will work for Windows, Mac or Linux. Here’s what it looks like in Windows 10.</p>
<p><img src="/202009_piperipheral/00000004.png" alt="Windows 10 Pop up message"><em>Windows 10 Pop up message</em></p>
<h2 id="configuring-key-presses">Configuring Key Presses</h2>
<p>The piperipheral.py Python code places events against each GPIO input. An event is fired when either the circuit is completed (button is pressed or the switch is flicked on) or when the circuit is disconnected (button is released or the switch is off).</p>
<p>A keypress is composed of a keyboard code (which represents a key on a keyboard) and a modifier (such as the Shift or control key). To produce a capital <em>B</em>, we would need to send the key code of 5 (for the letter <em>b</em>) and a modifier value of 00000010 (left Shift).</p>
<p><img src="/202009_piperipheral/00000005.png" alt="USB HID keyboard codes"><em>USB HID keyboard codes</em></p>
<p>For the entire mapping look at <a href="https://www.usb.org/sites/default/files/documents/hut1_12v2.pdf">usb.org</a></p>
<h2 id="keyboard-modifiers">Keyboard Modifiers</h2>
<p><img src="/202009_piperipheral/00000006.png" alt="Keyboard Modifiers"><em>Keyboard Modifiers</em></p>
<h2 id="gpio-to-key-mappings">GPIO to key mappings</h2>
<p>The GPIO line to key mapping is held in a Python collection</p>
<pre><code>*# Key mapping in the form*
*# GPIO_ID, (press-key,press-key-modifier, release-key,release-key-modifier) *

GPIO_BUTTON_1 = 6
KEY_B = 5

gpio_button_map = dict([
    (GPIO_BUTTON_1, (KEY_B,MOD_ALT, KEY_B,MOD_L_CNTR))  
  ])
</code></pre>
<h2 id="installing-the-pi-peripheral-service">Installing the Pi Peripheral Service</h2>
<p>Now the Raspberry Pi is acting like a USB Keyboard, we need to send some key commands. The <em>Pi Peripheral</em> is a Python programmed installed as a service</p>
<pre><code>sudo cp piperipheral.service /lib/systemd/system

sudo systemctl daemon-reload
sudo systemctl enable piperipheral.service
sudo systemctl start piperipheral.service
</code></pre>
<h2 id="game-control-binding">Game control binding</h2>
<p>This will be specific to your game or program. In <em>Microsoft Flight Simulator 2020</em> you can customize controls with this setup window.</p>
<p><img src="/202009_piperipheral/00000007.png" alt="Game keyboard mapping"><em>Game keyboard mapping</em></p>
<h2 id="code">Code</h2>
<p>Get the code at — <a href="https://github.com/saubury/pi-peripheral/">https://github.com/saubury/pi-peripheral/</a></p>
<h2 id="closing">Closing</h2>
<p>A few dollars and a bit of configuration and you can have your own Pi Peripheral</p>

</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					
				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://simonaubury.com/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2021 
			</p>
		</footer>
		
	
	
	</body>
</html>
